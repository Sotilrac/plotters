<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Sigmoid Maker</title>
		<link rel="stylesheet" href="./style.css">
		<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
		<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/tex-mml-chtml.js"></script>
	</head>
	<body>
		<div>
			<h1 class="centered">Sigmoid Maker</h1>
			<div id="coord" class='centered' style='color: grey; font-size: 10px; height: 15px'></div>
			<canvas id="canvas" class="centered" height="400" width="600"></canvas>
			<div id="formula">
				<p>\[Max \over {1-e^{-Rate(x-Midpoint)}}\]</p>
			</div>
			<div id="status" class='centered' style='color: grey; font-size: 10px'>Loading WebAssembly...</div>
			<div style="margin-top:20px"></div>
			<div class="control">
				<ul>
					<li><label>Midpoint</label><input type="number" id="mid" name="Midpoint" value="0.5" placeholder=""></li>
					<li><label>Max</label><input type="number" id="max" name="Max Value" value="1.0" placeholder=""></li>
					<li><label>Rate</label><input type="number" id="rate" name="Growth rate" value="1.0" min="1.0" placeholder=""></li>
					<li><label>y Min</label><input type="number" id="y_min" name="Growth rate" value="-1.0" placeholder=""></li>
					<li><label>y Max</label><input type="number" id="y_max" name="Growth rate" value="1.0" placeholder=""></li>
				</ul>
			</div>
		</div>
		<div style="margin-top:50px"></div>
		
		<script type="module">
			import * as wasm from "./pkg/wasm_demo.js";
			wasm.default("./pkg/wasm_demo_bg.wasm").then(function() {
				var map_coord = undefined;
				document.getElementById("canvas").addEventListener("mousemove", function(e) {
					if(map_coord === undefined) return false;
					var lx = map_coord(e.offsetX, e.offsetY, 0);
					var ly = map_coord(e.offsetX, e.offsetY, 1);
					if(Number.isNaN(lx) || Number.isNaN(ly)) {
						document.getElementById("coord").innerText = "Mouse poiner is out of range";
						return;
					}
					document.getElementById("coord").innerText = "(" + lx.toFixed(3) + "," + ly.toFixed(3) + ")";
				});
				var input_rate = document.getElementById("rate");
				var input_max = document.getElementById("max");
				var input_mid = document.getElementById("mid");
				var input_y_min = document.getElementById("y_min");
				var input_y_max = document.getElementById("y_max");
				var stat = document.getElementById("status");
				function update_plot() {
					stat.innerText = "Rendering ...";
					setTimeout(function() {
						map_coord = undefined;
						var start = performance.now();
						var rate = Number(input_rate.value);
						var mid = Number(input_mid.value);
						var max = Number(input_max.value);
						var y_max = Number(input_y_max.value);
						var y_min = Number(input_y_min.value);
						map_coord = wasm.draw_func("canvas", rate, max, mid, y_min, y_max);
						var end = performance.now();
						stat.innerText = "Rendered in " + (end - start) + "ms";
					}, 5);
				}
				stat.innerText = "WebAssembly loaded!";
				update_plot();
				input_rate.addEventListener("change", function (e) {update_plot();});
				input_mid.addEventListener("change", function (e) {update_plot();});
				input_max.addEventListener("change", function (e) {update_plot();});
				input_y_max.addEventListener("change", function (e) {update_plot();});
				input_y_min.addEventListener("change", function (e) {update_plot();});
			});
		</script>
	</body>
</html>